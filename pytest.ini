# =============================================================================
# GENERALIZED NOTATION NOTATION (GNN) - Pytest Configuration
# =============================================================================
# Comprehensive pytest configuration for the GNN pipeline testing framework
# Last Updated: 2026-01-21
# Pytest Version: >= 7.0.0
# =============================================================================

[pytest]

# =============================================================================
# TEST DISCOVERY AND COLLECTION
# =============================================================================

# Primary test directories
testpaths =
    src/tests
    tests

# Test file patterns
python_files =
    test_*.py
    *_test.py

# Test class and function patterns
python_classes =
    Test*
    *Tests
    *TestCase

python_functions =
    test_*

# Directories to ignore during collection
norecursedirs =
    .venv
    venv
    __pycache__
    .pytest_cache
    node_modules
    .git
    build
    dist
    output
    cache
    temp
    tmp

# =============================================================================
# TEST EXECUTION SETTINGS
# =============================================================================

# Core pytest options for consistent behavior
addopts =
    --strict-markers
    --strict-config
    --tb=short
    --durations=10
    --durations-min=1.0
    --maxfail=10
    -p no:randomly
    -p no:sugar
    -p no:stepwise

# Minimum pytest version requirement
minversion = 7.0

# =============================================================================
# TEST TIMEOUTS AND PERFORMANCE
# =============================================================================

# Global timeout settings
timeout = 300
timeout_method = thread

# Asyncio configuration for async tests
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# =============================================================================
# TEST MARKERS
# =============================================================================

markers =
    fast: Fast tests that complete in under 1 second
    slow: Slow tests that may take significant time
    unit: Unit tests for individual functions
    integration: Integration tests across modules
    pipeline: Pipeline infrastructure tests
    uv: UV package manager tests
    safe_to_fail: Tests that can fail without blocking CI

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = output/test_logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# WARNING FILTERS
# =============================================================================

filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    ignore::FutureWarning

# =============================================================================
# USAGE EXAMPLES
# =============================================================================
#
# Run all tests:
#   pytest
#
# Run only fast tests:
#   pytest -m fast
#
# Run with coverage:
#   pytest --cov=src --cov-report=html
#
# Debug failing tests:
#   pytest -xvs --pdb
# =============================================================================